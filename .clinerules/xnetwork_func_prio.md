# Приоритеты тестирования NetCom

Этот файл определяет иерархию приоритетов тестирования для проекта NetCom - P2P сети на Rust с Python биндингами.

## Общая стратегия тестирования

Тестирование выполняется по принципу **инкрементальной валидации** - от самых критичных базовых компонентов к сложным сетевым функциям. Каждая группа тестов должна проходить изолированно, и проблемы в группе более высокого приоритета блокируют выполнение групп более низкого приоритета.

## Иерархия приоритетов тестирования

### PRIORITY 1: CORE (Критический)
**Компоненты:** Базовая функциональность ноды
- Создание и уничтожение ноды
- Прослушивание портов
- Корректное завершение работы
- Освобождение ресурсов
- Диагностика состояния

**Критерии качества:**
- Покрытие кода: 95%+
- Все тесты должны проходить стабильно
- Нулевая толерантность к ошибкам

**Команды запуска:**
```bash
# Изолированный запуск
cargo nextest run core

# С остановкой при первой ошибке
cargo nextest run core --fail-fast

# Только core тесты
make test-priority-1
```

### PRIORITY 2: CORE_CONNECTIONS (Высокий)
**Компоненты:** Прямые соединения между нодами
- Прямое подключение нода-нода без посредников
- Управление соединениями (connect/disconnect)
- События подключения/отключения
- Таймауты соединений
- Обработка ошибок подключения

**Критерии качества:**
- Покрытие кода: 90%+
- Допускается 1-2 флакки-теста
- Стабильность соединений критична

**Команды запуска:**
```bash
cargo nextest run core_connections
cargo nextest run core_connections --fail-fast
make test-priority-2  # включает priority-1 + priority-2
```

### PRIORITY 3: XAUTH (Высокий)
**Компоненты:** Аутентификация и безопасность
- Аутентификация при подключении
- Проверка PoR (Proof of Representation)
- Сценарии успешной/неуспешной аутентификации
- Обновление аутентификации

**Критерии качества:**
- Покрытие кода: 85%+
- Критически важна безопасность
- Все сценарии аутентификации должны работать

**Команды запуска:**
```bash
cargo nextest run xauth
cargo nextest run xauth --fail-fast
make test-priority-3  # включает priority-1,2,3
```

### PRIORITY 4: XSTREAM (Средний)
**Компоненты:** Потоковая передача данных
- Открытие потоков между аутентифицированными нодами
- Двунаправленная передача данных
- Таймауты потоков
- Обработка ошибок передачи

**Критерии качества:**
- Покрытие кода: 80%+
- Стабильность передачи данных
- Допускается больше флакки-тестов

**Команды запуска:**
```bash
cargo nextest run xstream
cargo nextest run xstream --fail-fast
make test-priority-4  # включает priority-1,2,3,4
```

### PRIORITY 5: DISCOVERY (Средний)
**Компоненты:** Механизмы обнаружения нод
- **mdns:** Обнаружение в локальной сети
- **bootstrap:** Обнаружение через bootstrap-ноды
- **kademlia:** DHT-based discovery

**Критерии качества:**
- Покрытие кода: 75%+
- Допускается больше флакки-тестов
- Сложная сетевая логика

**Команды запуска:**
```bash
cargo nextest run discovery
cargo nextest run discovery --fail-fast
make test-priority-5  # включает priority-1,2,3,4,5
```

### PRIORITY 6: CONNECTIVITY (Низкий)
**Компоненты:** Расширенная сетевая функциональность
- **relay:** Релейные соединения
- **nat_traversal:** Обход NAT (если будет)
- **circuit:** Circuit relay функциональность

**Критерии качества:**
- Покрытие кода: 70%+
- Сложная сетевая логика
- Допускается больше флакки-тестов

**Команды запуска:**
```bash
cargo nextest run connectivity
cargo nextest run connectivity --fail-fast
make test-priority-6  # полный набор тестов
```

## Процесс тестирования

### Инкрементальное тестирование
```bash
# Проверка только критичных компонентов
make test-priority-1

# Постепенное добавление функциональности
make test-priority-2
make test-priority-3
# ... и так далее

# Полное тестирование
make test-priority-6
```

### Полное тестирование с остановкой
```bash
# Останавливается при первой ошибке в любой группе
make test-all-prioritized
```

### Изолированное тестирование групп
```bash
# Для отладки конкретной группы
make test-isolated-core
make test-isolated-connections
make test-isolated-xauth
make test-isolated-xstream
make test-isolated-discovery
make test-isolated-connectivity
```

## Правила выполнения

1. **Остановка при проблемах:** Если группа тестов более высокого приоритета имеет проблемы, выполнение групп более низкого приоритета блокируется.

2. **Изоляция тестов:** Каждая группа тестов должна выполняться изолированно для предотвращения взаимного влияния.

3. **Приоритет исправлений:** Ошибки в группах более высокого приоритета исправляются в первую очередь.

4. **Валидация покрытия:** Покрытие кода проверяется после успешного прохождения всех тестов группы.

## Интеграция с CI/CD

В CI/CD пайплайне тестирование выполняется по приоритетам:

```yaml
test_netcom:
  stages:
    - test-priority-1
    - test-priority-2  
    - test-priority-3
    - test-priority-4
    - test-priority-5
    - test-priority-6
    - coverage-report
```

Каждая стадия зависит от успешного выполнения предыдущей.

## Структура тестовых директорий

```
xnetwork/tests/
├── core/                 # PRIORITY 1
├── core_connections/     # PRIORITY 2  
├── xauth/               # PRIORITY 3
├── xstream/             # PRIORITY 4
├── discovery/           # PRIORITY 5
│   ├── mdns/
│   ├── bootstrap/
│   └── kademlia/
└── connectivity/        # PRIORITY 6
    └── relay/
```

## Чеклист валидации

- [ ] Все core тесты проходят стабильно
- [ ] Core connections работают без флакки-поведения
- [ ] XAuth обеспечивает безопасную аутентификацию
- [ ] XStream стабильно передает данные
- [ ] Discovery механизмы находят ноды
- [ ] Connectivity функции работают в сложных сетевых условиях
- [ ] Покрытие кода соответствует стандартам для каждой группы
- [ ] Тесты изолированы и не влияют друг на друга
