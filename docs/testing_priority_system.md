# Система приоритетного тестирования NetCom

## Обзор

Эта система обеспечивает инкрементальную валидацию тестов от самых критичных базовых компонентов к сложным сетевым функциям.

## Приоритеты тестирования

### PRIORITY 1: CORE (Критический)
- **Компоненты**: Базовая функциональность ноды
- **Критерии**: 95%+ покрытие кода, нулевая толерантность к ошибкам
- **Тесты**: Создание/уничтожение ноды, прослушивание портов, завершение работы

### PRIORITY 2: CORE_CONNECTIONS (Высокий)
- **Компоненты**: Прямые соединения между нодами
- **Критерии**: 90%+ покрытие кода
- **Тесты**: Подключение/отключение, события соединений, таймауты

### PRIORITY 3: XAUTH (Высокий)
- **Компоненты**: Аутентификация и безопасность
- **Критерии**: 85%+ покрытие кода
- **Тесты**: PoR проверка, сценарии аутентификации

### PRIORITY 4: XSTREAM (Средний)
- **Компоненты**: Потоковая передача данных
- **Критерии**: 80%+ покрытие кода
- **Тесты**: Открытие потоков, передача данных, таймауты

### PRIORITY 5: DISCOVERY (Средний)
- **Компоненты**: Механизмы обнаружения нод
- **Критерии**: 75%+ покрытие кода
- **Тесты**: mDNS, bootstrap, Kademlia

### PRIORITY 6: CONNECTIVITY (Низкий)
- **Компоненты**: Расширенная сетевая функциональность
- **Критерии**: 70%+ покрытие кода
- **Тесты**: Relay, NAT traversal, circuit relay

## Команды Makefile

```bash
# Полное тестирование
make test

# Приоритетное тестирование
make test-priority-1  # Только CORE тесты
make test-priority-2  # CORE + CORE_CONNECTIONS
make test-priority-3  # PRIORITY 1-3
make test-priority-4  # PRIORITY 1-4
make test-priority-5  # PRIORITY 1-5
make test-priority-6  # Все тесты

# Полное тестирование с остановкой при ошибках
make test-all-prioritized
```

## Правила выполнения

1. **Остановка при проблемах**: Если группа тестов более высокого приоритета имеет проблемы, выполнение групп более низкого приоритета блокируется

2. **Изоляция тестов**: Каждая группа тестов выполняется изолированно для предотвращения взаимного влияния

3. **Приоритет исправлений**: Ошибки в группах более высокого приоритета исправляются в первую очередь

4. **Валидация покрытия**: Покрытие кода проверяется только после успешного прохождения всех тестов группы

## Best Practices

### Для разработчиков
- Всегда запускайте `make test-priority-1` перед коммитом
- Используйте `make test-all-prioritized` для полной проверки
- Добавляйте таймауты для всех сетевых тестов
- Изолируйте тестовые группы для предотвращения взаимного влияния

### Для CI/CD
- Выполняйте тестирование по приоритетам в CI пайплайне
- Останавливайте пайплайн при ошибках в группах высокого приоритета
- Генерируйте отчеты о покрытии только после успешных тестов

## Примеры использования

### Быстрая проверка
```bash
# Проверить только критичные компоненты
make test-priority-1

# Проверить базовую сетевую функциональность
make test-priority-3
```

### Отладка
```bash
# Запустить конкретный тест с детальным выводом
cargo test test_node_shutdown -- --nocapture

# Запустить тесты с остановкой при первой ошибке
cargo test core -- --fail-fast
```

### CI/CD интеграция
```yaml
test_netcom:
  stages:
    - test-priority-1
    - test-priority-2  
    - test-priority-3
    - test-priority-4
    - test-priority-5
    - test-priority-6
    - coverage-report
```

## Чеклист валидации

- [ ] Все core тесты проходят стабильно
- [ ] Core connections работают без флакки-поведения
- [ ] XAuth обеспечивает безопасную аутентификацию
- [ ] XStream стабильно передает данные
- [ ] Discovery механизмы находят ноды
- [ ] Connectivity функции работают в сложных сетевых условиях
- [ ] Покрытие кода соответствует стандартам для каждой группы
- [ ] Тесты изолированы и не влияют друг на друга
