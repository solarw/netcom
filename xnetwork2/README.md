# XNetwork2 - P2P ÑĞµÑ‚ÑŒ Ğ½Ğ° Rust Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¾Ğ¹ command-swarm

[![Rust](https://img.shields.io/badge/rust-2024-orange.svg)](https://www.rust-lang.org)
[![libp2p](https://img.shields.io/badge/libp2p-0.56-blue.svg)](https://libp2p.io)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

**XNetwork2** - ÑÑ‚Ğ¾ Ğ¿ĞµÑ€ĞµÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ P2P ÑĞµÑ‚Ğ¸ Ğ½Ğ° Rust, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ command-swarm Ğ´Ğ»Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ libp2p swarm Ñ‡ĞµÑ€ĞµĞ· Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ handlers. ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½ÑƒÑ Ğ¾ÑĞ½Ğ¾Ğ²Ñƒ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

## ğŸš€ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

- **Command-based Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°** - Ğ²ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
- **Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ°Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ** Ñ‡ĞµÑ€ĞµĞ· xauth Ñ Proof of Representation
- **ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** Ñ‡ĞµÑ€ĞµĞ· xstream Ñ Ğ´Ğ²ÑƒĞ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°Ğ¼Ğ¸
- **ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸** Ğ½Ğ° Ğ±Ğ°Ğ·Ğµ tokio Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ½ĞµĞ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒÑ
- **Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹** Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· broadcast ĞºĞ°Ğ½Ğ°Ğ»Ñ‹
- **Graceful shutdown** - ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸ĞµĞ¼ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
- **ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°** - Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ protocol behaviour
- **Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - ÑÑ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
XNetwork2
â”œâ”€â”€ Node (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼)
â”‚   â”œâ”€â”€ SwarmLoop (Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸)
â”‚   â”œâ”€â”€ Commander (API Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´)
â”‚   â””â”€â”€ Event System (broadcast ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ)
â”œâ”€â”€ Behaviour Handlers
â”‚   â”œâ”€â”€ IdentifyHandler (Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¸Ñ€Ğ¾Ğ²)
â”‚   â”œâ”€â”€ PingHandler (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸)
â”‚   â”œâ”€â”€ XAuthHandler (Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ)
â”‚   â””â”€â”€ XStreamHandler (Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ°)
â””â”€â”€ Swarm Handler
    â””â”€â”€ XNetworkSwarmHandler (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸ÑĞ¼Ğ¸)
```

## ğŸ“¦ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```toml
[dependencies]
xnetwork2 = { path = "../xnetwork2" }
```

### ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€

```rust
use xnetwork2::Node;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error + Send + Sync>> {
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ´Ñ‹
    let mut node = Node::new().await?;
    println!("âœ… ĞĞ¾Ğ´Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ PeerId: {}", node.peer_id());
    
    // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
    let mut events = node.subscribe();
    
    // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğ¾Ğ´Ñ‹
    node.start().await?;
    println!("âœ… ĞĞ¾Ğ´Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°");
    
    // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ñ‡ĞµÑ€ĞµĞ· Commander
    node.commander.listen_on("/ip4/127.0.0.1/udp/0/quic-v1".parse()?).await?;
    println!("âœ… ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° listen_on Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°");
    
    // Graceful shutdown
    node.commander.shutdown().await?;
    node.wait_for_shutdown().await?;
    println!("âœ… ĞĞ¾Ğ´Ğ° ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°");
    
    Ok(())
}
```

## ğŸ“š API Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

### Node

ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ P2P Ğ½Ğ¾Ğ´Ğ¾Ğ¹:

```rust
// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ´Ñ‹
let mut node = Node::new().await?;

// Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğ¾Ğ´Ñ‹
node.start().await?;

// ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
let mut events = node.subscribe();

// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ PeerId
let peer_id = node.peer_id();

// Graceful shutdown
node.commander.shutdown().await?;
node.wait_for_shutdown().await?;
```

### Commander

API Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ½Ğ¾Ğ´Ğµ:

```rust
// ĞŸÑ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°Ğ´Ñ€ĞµÑĞ°
commander.listen_on("/ip4/127.0.0.1/udp/0/quic-v1".parse()?).await?;

// Echo ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° (Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
let response = commander.echo("Hello, XNetwork2!".to_string()).await?;

// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ ÑĞµÑ‚Ğ¸
let state = commander.get_network_state().await?;

// Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
commander.shutdown().await?;
```

### Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (NodeEvent)

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ½Ğ¾Ğ´Ñ‹:

```rust
use xnetwork2::node_events::NodeEvent;

let mut events = node.subscribe();

while let Ok(event) = events.recv().await {
    match event {
        NodeEvent::NewListenAddr { address } => {
            println!("ğŸ“¡ ĞĞ¾Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ñ‚ÑŒ: {}", address);
        }
        NodeEvent::ConnectionEstablished { peer_id } => {
            println!("ğŸ”— Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ: {}", peer_id);
        }
        NodeEvent::ConnectionClosed { peer_id } => {
            println!("ğŸ”Œ Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾ Ñ: {}", peer_id);
        }
        NodeEvent::ExpiredListenAddr { address } => {
            println!("âŒ ĞĞ´Ñ€ĞµÑ Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ÑÑ‚ĞµĞº: {}", address);
        }
        _ => {
            println!("ğŸ“Š ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ: {:?}", event);
        }
    }
}
```

## ğŸ”§ Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸

```rust
use xnetwork2::{Node, node_events::NodeEvent};
use libp2p::Multiaddr;
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error + Send + Sync>> {
    println!("ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº XNetwork2 Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹...");

    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ´Ñ‹
    let mut node = Node::new().await?;
    println!("âœ… ĞĞ¾Ğ´Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ° Ñ PeerId: {}", node.peer_id());

    // ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
    let mut events = node.subscribe();

    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ´Ğ»Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
    let events_task = tokio::spawn(async move {
        while let Ok(event) = events.recv().await {
            match event {
                NodeEvent::NewListenAddr { address } => {
                    println!("ğŸ“¡ ĞĞ¾Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ñ‚ÑŒ: {}", address);
                }
                NodeEvent::ConnectionEstablished { peer_id } => {
                    println!("ğŸ”— Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ: {}", peer_id);
                }
                NodeEvent::ConnectionClosed { peer_id } => {
                    println!("ğŸ”Œ Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¾ Ñ: {}", peer_id);
                }
                _ => {}
            }
        }
    });

    // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğ¾Ğ´Ñ‹
    node.start().await?;

    // ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ¿Ñ€Ğ¾ÑĞ»ÑƒÑˆĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ
    node.commander.listen_on("/ip4/127.0.0.1/udp/0/quic-v1".parse()?).await?;

    // Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ğ½Ğ¾Ğ´Ñ‹
    sleep(Duration::from_secs(5)).await;

    // Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
    node.commander.shutdown().await?;
    node.wait_for_shutdown().await?;

    // ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
    events_task.abort();
    
    println!("âœ… ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½!");
    Ok(())
}
```

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ²ÑƒĞ¼Ñ Ğ½Ğ¾Ğ´Ğ°Ğ¼Ğ¸

```rust
use xnetwork2::Node;
use tokio::time::{sleep, Duration};

#[tokio::test]
async fn test_two_nodes_connection() {
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ²ÑƒÑ… Ğ½Ğ¾Ğ´
    let mut node1 = Node::new().await.expect("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ 1");
    let mut node2 = Node::new().await.expect("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ 2");
    
    // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¾Ğ±ĞµĞ¸Ñ… Ğ½Ğ¾Ğ´
    node1.start().await.expect("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ 1");
    node2.start().await.expect("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ 2");
    
    // Ğ—Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ´
    // Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    
    // Graceful shutdown
    node1.commander.shutdown().await.expect("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ 1");
    node2.commander.shutdown().await.expect("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ´Ñƒ 2");
    
    node1.wait_for_shutdown().await.expect("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ´Ñ‹ 1");
    node2.wait_for_shutdown().await.expect("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ´Ñ‹ 2");
}
```

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹:

```bash
# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ²ÑĞµÑ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²
cd xnetwork2
cargo test

# Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ°
cargo test test_node_lifecycle_in_5_seconds
cargo test test_two_nodes_connection
cargo test test_two_nodes_xstream_data_transfer
cargo test test_xauth_mutual_authentication
```

### Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹:

- **`test_node_lifecycle_in_5_seconds`** - Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ½Ğ¾Ğ´Ñ‹ Ğ·Ğ° 5 ÑĞµĞºÑƒĞ½Ğ´
- **`test_two_nodes_connection`** - ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ²ÑƒĞ¼Ñ Ğ½Ğ¾Ğ´Ğ°Ğ¼Ğ¸
- **`test_two_nodes_xstream_data_transfer`** - Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‡ĞµÑ€ĞµĞ· xstream
- **`test_xauth_mutual_authentication`** - Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ½Ğ°Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· xauth

## ğŸ” ĞÑ‚Ğ»Ğ°Ğ´ĞºĞ°

Ğ”Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:

```rust
use tracing_subscriber;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error + Send + Sync>> {
    // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    tracing_subscriber::fmt::init();
    
    // ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ĞºĞ¾Ğ´...
    Ok(())
}
```

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
xnetwork2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs                    # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ¸ re-exports
â”‚   â”œâ”€â”€ node.rs                   # Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ Ğ½Ğ¾Ğ´Ñ‹
â”‚   â”œâ”€â”€ commander.rs              # API Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
â”‚   â”œâ”€â”€ node_events.rs            # Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
â”‚   â”œâ”€â”€ main_behaviour.rs         # ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ behaviour
â”‚   â”œâ”€â”€ swarm_handler.rs          # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº swarm-level Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
â”‚   â”œâ”€â”€ swarm_commands.rs         # Swarm-level ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
â”‚   â””â”€â”€ behaviours/               # Behaviour handlers
â”‚       â”œâ”€â”€ mod.rs               # Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… handlers
â”‚       â”œâ”€â”€ identify/            # Identify handler
â”‚       â”œâ”€â”€ ping/               # Ping handler
â”‚       â”œâ”€â”€ xauth/              # XAuth adapter
â”‚       â””â”€â”€ xstream/            # XStream adapter
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ command_demo.rs          # ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
â””â”€â”€ tests/
    â”œâ”€â”€ node_lifecycle_integration.rs
    â”œâ”€â”€ two_nodes_connection.rs
    â”œâ”€â”€ two_nodes_xstream_data_transfer.rs
    â””â”€â”€ xauth_mutual_authentication.rs
```

## ğŸ”— Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸

- **libp2p 0.56** - Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ P2P Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ°
- **command-swarm** - Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ swarm
- **xauth** - Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ Proof of Representation
- **xstream** - Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- **tokio** - Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ
- **tracing** - Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

## ğŸ¤ Ğ’ĞºĞ»Ğ°Ğ´ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚

1. Ğ¤Ğ¾Ñ€ĞºĞ½Ğ¸Ñ‚Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²ĞµÑ‚ĞºÑƒ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (`git checkout -b feature/amazing-feature`)
3. Ğ—Ğ°Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ (`git commit -m 'Add amazing feature'`)
4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² Ğ²ĞµÑ‚ĞºÑƒ (`git push origin feature/amazing-feature`)
5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Pull Request

## ğŸ“„ Ğ›Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ñ

Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ´ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸ĞµĞ¹ MIT. ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¼. Ğ² Ñ„Ğ°Ğ¹Ğ»Ğµ [LICENSE](LICENSE).

## ğŸ“ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°

- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ issue Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ±Ğ°Ğ³Ğ¾Ğ² Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹
- Ğ”Ğ»Ñ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ discussions

---

**XNetwork2** - Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ°Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ° Ğ´Ğ»Ñ Ğ²Ğ°ÑˆĞ¸Ñ… P2P Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ½Ğ° Rust! ğŸš€
