//! XNetwork2 - P2P —Å–µ—Ç—å –Ω–∞ Rust —Å Python –±–∏–Ω–¥–∏–Ω–≥–∞–º–∏
//! 
//! –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Node —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ listen_on –∏ echo, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π —Å–æ–±—ã—Ç–∏–π

use xnetwork2::{Node, node_events::NodeEvent};
use libp2p::Multiaddr;
use tokio::time::{sleep, Duration};
use tokio::sync::broadcast;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error + Send + Sync>> {
    println!("üöÄ –ó–∞–ø—É—Å–∫ XNetwork2 —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π —Å–æ–±—ã—Ç–∏–π...");

    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –Ω–æ–¥—É
    let mut node = Node::new().await?;
    println!("‚úÖ –ù–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ");

    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –Ω–æ–¥—ã (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ —Å broadcast)
    let mut events1 = node.subscribe();
    let mut events2 = node.subscribe();
    println!("üì° –ü–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏—è –Ω–æ–¥—ã (2 –ø–æ–¥–ø–∏—Å—á–∏–∫–∞)");

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
    let events_task1 = tokio::spawn(async move {
        println!("üéØ –ó–∞–ø—É—â–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 1)...");
        loop {
            match events1.recv().await {
                Ok(event) => {
                    match event {
                        NodeEvent::NewListenAddr { address } => {
                            println!("üì° [–°–û–ë–´–¢–ò–ï-1] –ù–æ–¥–∞ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å –∞–¥—Ä–µ—Å: {}", address);
                        }
                        NodeEvent::ConnectionEstablished { peer_id } => {
                            println!("üîó [–°–û–ë–´–¢–ò–ï-1] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø–∏—Ä–æ–º: {}", peer_id);
                        }
                        NodeEvent::ConnectionClosed { peer_id } => {
                            println!("üîå [–°–û–ë–´–¢–ò–ï-1] –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ —Å –ø–∏—Ä–æ–º: {}", peer_id);
                        }
                        NodeEvent::ExpiredListenAddr { address } => {
                            println!("‚ùå [–°–û–ë–´–¢–ò–ï-1] –ê–¥—Ä–µ—Å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∏—Å—Ç–µ–∫: {}", address);
                        }
                        _ => {
                            println!("üìä [–°–û–ë–´–¢–ò–ï-1] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: {:?}", event);
                        }
                    }
                }
                Err(broadcast::error::RecvError::Closed) => {
                    println!("üõë –ö–∞–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –∑–∞–∫—Ä—ã—Ç (–ø–æ–¥–ø–∏—Å—á–∏–∫ 1)");
                    break;
                }
                Err(broadcast::error::RecvError::Lagged(_)) => {
                    println!("‚ö†Ô∏è –ü–æ–¥–ø–∏—Å—á–∏–∫ 1 –æ—Ç—Å—Ç–∞–ª –æ—Ç —Å–æ–±—ã—Ç–∏–π, –ø—Ä–æ–ø—É—â–µ–Ω—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è");
                    continue;
                }
            }
        }
        println!("üõë –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 1) –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
    });

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
    let events_task2 = tokio::spawn(async move {
        println!("üéØ –ó–∞–ø—É—â–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 2)...");
        loop {
            match events2.recv().await {
                Ok(event) => {
                    match event {
                        NodeEvent::NewListenAddr { address } => {
                            println!("üì° [–°–û–ë–´–¢–ò–ï-2] –ù–æ–¥–∞ –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å –∞–¥—Ä–µ—Å: {}", address);
                        }
                        NodeEvent::ConnectionEstablished { peer_id } => {
                            println!("üîó [–°–û–ë–´–¢–ò–ï-2] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø–∏—Ä–æ–º: {}", peer_id);
                        }
                        NodeEvent::ConnectionClosed { peer_id } => {
                            println!("üîå [–°–û–ë–´–¢–ò–ï-2] –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ —Å –ø–∏—Ä–æ–º: {}", peer_id);
                        }
                        NodeEvent::ExpiredListenAddr { address } => {
                            println!("‚ùå [–°–û–ë–´–¢–ò–ï-2] –ê–¥—Ä–µ—Å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∏—Å—Ç–µ–∫: {}", address);
                        }
                        _ => {
                            println!("üìä [–°–û–ë–´–¢–ò–ï-2] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: {:?}", event);
                        }
                    }
                }
                Err(broadcast::error::RecvError::Closed) => {
                    println!("üõë –ö–∞–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –∑–∞–∫—Ä—ã—Ç (–ø–æ–¥–ø–∏—Å—á–∏–∫ 2)");
                    break;
                }
                Err(broadcast::error::RecvError::Lagged(_)) => {
                    println!("‚ö†Ô∏è –ü–æ–¥–ø–∏—Å—á–∏–∫ 2 –æ—Ç—Å—Ç–∞–ª –æ—Ç —Å–æ–±—ã—Ç–∏–π, –ø—Ä–æ–ø—É—â–µ–Ω—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è");
                    continue;
                }
            }
        }
        println!("üõë –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 2) –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
    });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
    println!("üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è: {}", node.get_task_status());
    println!("üîÑ –ó–∞–¥–∞—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: {}", node.is_running());

    // –ü–æ–ª—É—á–∞–µ–º Commander –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥
    let commander = node.commander.clone();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–¥—É
    node.start().await.expect("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–¥—É");

    // –î–∞–µ–º –Ω–æ–¥–µ –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    sleep(Duration::from_millis(500)).await;

    // –¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ–º PeerId –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
    let peer_id = node.commander.get_network_state().await?.peer_id;
    println!("‚úÖ –ù–æ–¥–∞ –∑–∞–ø—É—â–µ–Ω–∞ —Å PeerId: {}", peer_id);

    // –î–∞–µ–º –Ω–æ–¥–µ –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
    sleep(Duration::from_millis(500)).await;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
    println!("üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞: {}", node.get_task_status());
    println!("üîÑ –ó–∞–¥–∞—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: {}", node.is_running());

    println!("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –Ω–æ–¥–µ...");

    // –ö–æ–º–∞–Ω–¥–∞ 1: –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è
    let listen_addr: Multiaddr = "/ip4/127.0.0.1/udp/0/quic-v1".parse().unwrap();
    let resp = commander.listen_on(listen_addr.clone()).await?;
    println!("‚úÖ –æ—Ç–≤–µ—Ç –æ—Ç –∫–æ–º–∞–Ω–¥—ã listen_on: {:?}", resp);

    // –ö–æ–º–∞–Ω–¥–∞ 2: Echo –∫–æ–º–∞–Ω–¥–∞ - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã response –∫–∞–Ω–∞–ª–æ–≤
    let test_message = "–ü—Ä–∏–≤–µ—Ç, XNetwork2!".to_string();
    println!("üì¢ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º echo –∫–æ–º–∞–Ω–¥—É: '{}'", test_message);
    
    let echo_response = commander.echo(test_message.clone()).await?;
    println!("üì¢ –ü–æ–ª—É—á–µ–Ω echo –æ—Ç–≤–µ—Ç: '{}'", echo_response);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–µ—Ä–Ω—É–ª–æ—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    assert_eq!(test_message, echo_response, "‚ùå Echo –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç");
    println!("‚úÖ Echo –∫–æ–º–∞–Ω–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!");

    // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    let network_state = commander.get_network_state().await?;
    println!("üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–∏:");
    println!("   Peer ID: {}", network_state.peer_id);
    println!("   –ê–¥—Ä–µ—Å–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è: {:?}", network_state.listening_addresses);
    println!("   –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–∏—Ä—ã: {:?}", network_state.connected_peers);

    // –î–∞–µ–º –Ω–æ–¥–µ –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ
    println!("‚è≥ –ù–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–æ–º–∞–Ω–¥–∞–º–∏... (–æ–∂–∏–¥–∞–Ω–∏–µ 2 —Å–µ–∫—É–Ω–¥—ã)");
    sleep(Duration::from_secs(2)).await;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
    println!("üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º: {}", node.get_task_status());
    println!("üîÑ –ó–∞–¥–∞—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: {}", node.is_running());

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –¥–≤—É—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:

    // –°–ø–æ—Å–æ–± 1: Graceful shutdown —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π)
    println!("üõë –°–ø–æ—Å–æ–± 1: Graceful shutdown —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã...");
    commander.shutdown().await?;
    println!("‚úÖ –ö–æ–º–∞–Ω–¥–∞ graceful shutdown –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞");

    // –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
    println!("‚è≥ –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏...");
    match node.wait_for_shutdown().await {
        Ok(_) => println!("‚úÖ –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ"),
        Err(e) => println!("‚ùå –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π: {}", e),
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏
    println!("üìä –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞—á–∏: {}", node.get_task_status());
    println!("üîÑ –ó–∞–¥–∞—á–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: {}", node.is_running());

    // –î–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
    println!("‚è≥ –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π...");
    sleep(Duration::from_millis(500)).await;

    // –û—Ç–º–µ–Ω—è–µ–º –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å–∞–º–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞–Ω–∞–ª–∞)
    println!("üõë –û—Ç–º–µ–Ω—è–µ–º –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π...");
    events_task1.abort();
    events_task2.abort();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–¥–∞—á —Å–æ–±—ã—Ç–∏–π
    match events_task1.await {
        Ok(_) => println!("‚úÖ –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 1) –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ"),
        Err(e) => {
            if e.is_cancelled() {
                println!("‚úÖ –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 1) –±—ã–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∞");
            } else {
                println!("‚ùå –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 1) –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π: {}", e);
            }
        }
    }
    
    match events_task2.await {
        Ok(_) => println!("‚úÖ –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 2) –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ"),
        Err(e) => {
            if e.is_cancelled() {
                println!("‚úÖ –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 2) –±—ã–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∞");
            } else {
                println!("‚ùå –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π (–ø–æ–¥–ø–∏—Å—á–∏–∫ 2) –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π: {}", e);
            }
        }
    }

    println!("‚úÖ –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!");

    // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –°–ø–æ—Å–æ–± 2 (force_shutdown) –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—Å–ª–∏ graceful shutdown –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
    // node.force_shutdown().await?;

    Ok(())
}
